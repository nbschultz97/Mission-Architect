<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ceradon Mission Architect</title>
  <script src="mission_project.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
  <body>
  <div id="access-gate" class="access-overlay" style="display: none;">
    <div class="gate-card">
      <h1>Ceradon Mission Architect</h1>
      <p class="gate-subtitle">Ceradon Mission Architect demo access. Enter the issued code to continue.</p>
      <label for="demo-code">Access code</label>
      <input id="demo-code" type="password" autocomplete="off" placeholder="Enter access code">
      <button id="demo-enter" class="primary-btn">Enter</button>
      <div id="demo-error" class="error-message">Invalid code.</div>
    </div>

    <section id="demo-request" class="demo-request">
      <div class="demo-request-inner">
        <h2>Request a demo code</h2>
        <p>
          Ceradon Systems provides controlled access to <strong>Ceradon Mission Architect</strong> for qualified organizations.
          Request a demo code to explore the live planner and see how it fits your mission profiles.
        </p>
        <div class="demo-request-actions">
          <a
            id="demo-request-button"
            class="primary-btn demo-request-btn"
            href="mailto:contact@ceradonsystems.com?subject=Demo%20code%20request%20%E2%80%93%20Ceradon%20Mission%20Architect&body=Hi%20Ceradon%20team,%0D%0A%0D%0AI%27d%20like%20to%20request%20a%20demo%20access%20code%20for%20Ceradon%20Mission%20Architect.%0D%0A%0D%0AOrganization:%20%0D%0AUse%20case:%20%0D%0ATimeline:%20%0D%0A%0D%0AThank%20you.">
            Request a demo code
          </a>

          <p class="demo-request-email">
            Or email us at
            <a href="mailto:contact@ceradonsystems.com?subject=Demo%20code%20request%20%E2%80%93%20Ceradon%20Mission%20Architect">
              contact@ceradonsystems.com
            </a>
            with your organization and use case.
          </p>
        </div>
      </div>
    </section>
  </div>

  <div id="app-root">
    <div id="statusBanner" class="status-banner" style="display:none;"></div>
    <header class="top-nav">
      <div class="branding">
        <div class="title">Ceradon Mission Architect</div>
        <div class="subtitle">Mission-level planner for Ceradon Architect Stack</div>
      </div>
      <div class="version-chip" id="headerVersion"></div>
      <div class="schema-chip" id="schemaBadge"></div>
      <nav class="nav-tabs">
        <button class="nav-btn" data-target="setup">1) Mission Setup</button>
        <button class="nav-btn" data-target="phases">2) Phases</button>
        <button class="nav-btn" data-target="assets">3) Assets &amp; Assignment</button>
        <button class="nav-btn" data-target="constraints">4) Constraints</button>
        <button class="nav-btn" data-target="brief">5) Mission Brief / Export</button>
        <button class="nav-btn" data-target="mission-cards">6) Mission Cards</button>
      </nav>
      <button id="loadExampleBtn" class="accent-btn">Load demo mission</button>
    </header>

    <main>
      <section id="setup" class="panel active">
        <h2>Mission Setup</h2>
        <div class="preset-row">
          <label class="preset-label">Mission preset
            <select id="missionPreset">
              <option value="">Select a doctrinal preset…</option>
              <option value="cold-weather">Cold-weather ridge mesh recon</option>
              <option value="urban-ew">Urban mesh lane in EW environment</option>
              <option value="partner-uxs">Partner-force sustainment &amp; UxS support</option>
            </select>
          </label>
          <div id="presetHelper" class="preset-helper">Applies mission type, duration, environment bands, and phase framing.</div>
        </div>
        <div class="grid two-col">
          <label>Mission Name<input id="missionName" type="text" placeholder="Mission name"></label>
          <label>Mission Type
            <select id="missionType">
              <option>Recon</option>
              <option>Mesh Lane</option>
              <option>Resupply</option>
              <option>UxS Test</option>
              <option>Custom</option>
            </select>
          </label>
          <label>AO / Location<input id="missionAo" type="text" placeholder="Area of operations"></label>
          <label>Unit / Detachment<input id="missionUnit" type="text" placeholder="Unit or detachment"></label>
          <label>Classification Banner<input id="missionBanner" type="text" value="UNCLASSIFIED // TRAINING USE"></label>
          <label>Date / Time Window<input id="missionTime" type="text" placeholder="H+0 to H+72"></label>
          <label>Created By<input id="missionCreator" type="text" placeholder="Planner name"></label>
          <label>Created On<input id="missionDate" type="date"></label>
          <label>Mission Duration (hrs)
            <div class="inline-input">
              <input id="missionDuration" type="number" min="0" placeholder="0">
              <div class="chip-row">
                <button class="secondary-btn" type="button" data-duration="24">24h</button>
                <button class="secondary-btn" type="button" data-duration="48">48h</button>
                <button class="secondary-btn" type="button" data-duration="72">72h</button>
              </div>
            </div>
          </label>
          <label>Altitude Band
            <select id="missionAltitude"></select>
          </label>
          <label>Temperature Band
            <select id="missionTemperature"></select>
          </label>
        </div>
        <div class="button-row">
          <button id="newMissionBtn" class="secondary-btn">New Mission</button>
          <button id="saveMissionBtn" class="primary-btn">Save Mission</button>
          <div class="dropdown">
            <button id="loadMissionBtn" class="secondary-btn">Load Mission…</button>
            <div id="savedMissionsList" class="dropdown-content"></div>
          </div>
          <button id="deleteMissionBtn" class="danger-btn">Delete Mission</button>
          <button id="importMissionProjectBtn" class="secondary-btn">Import MissionProject JSON</button>
          <input type="file" id="missionProjectFile" accept="application/json" style="display:none" />
        </div>

        <details class="integrations">
          <summary>Advanced import helpers</summary>
          <p class="muted helper-text">Paste JSON from other Architect tools when you want to merge Nodes, UxS platforms, Mesh links, or KitSmith kits into the current MissionProject. Use full MissionProject imports when you need the entire mission and constraints bundle. Unknown keys are preserved and exported, and schemaVersion is respected when round-tripping.</p>
          <div class="grid two-col">
            <div>
              <label>Paste Node Architect JSON (updates nodes)<textarea id="nodeJson"></textarea></label>
              <button data-parse="node" class="secondary-btn parse-btn">Parse &amp; Add Assets</button>
            </div>
            <div>
              <label>Paste UxS Architect JSON (updates platforms)<textarea id="uxsJson"></textarea></label>
              <button data-parse="uxs" class="secondary-btn parse-btn">Parse &amp; Add Assets</button>
            </div>
            <div>
              <label>Paste Mesh Architect JSON (updates mesh_links)<textarea id="meshJson"></textarea></label>
              <button data-parse="mesh" class="secondary-btn parse-btn">Parse &amp; Add Links</button>
            </div>
            <div>
              <label>Paste KitSmith JSON (updates kits)<textarea id="kitJson"></textarea></label>
              <button data-parse="kit" class="secondary-btn parse-btn">Parse &amp; Add Kits</button>
            </div>
          </div>
          <div class="button-row">
            <button id="importNodeBtn" type="button" class="secondary-btn">Import Node Designs</button>
            <button id="importPlatformBtn" type="button" class="secondary-btn">Import Platform Designs</button>
            <button id="importMeshBtn" type="button" class="secondary-btn">Import Mesh JSON</button>
          </div>
        </details>
      </section>

      <section id="phases" class="panel">
        <div class="panel-header">
          <h2>Phases</h2>
          <button id="addPhaseBtn" class="primary-btn">Add Phase</button>
        </div>
        <div id="phasesContainer" class="phase-list"></div>
      </section>

      <section id="assets" class="panel">
        <div class="panel-header">
          <h2>Assets &amp; Assignment</h2>
          <div>
            <button id="addAssetBtn" class="primary-btn">Add Asset</button>
            <button id="seedAssetsBtn" class="secondary-btn">Load Demo Assets</button>
          </div>
        </div>
        <div class="asset-table" id="assetTable"></div>
        <h3>Assignment Matrix</h3>
        <div id="assignmentMatrix" class="matrix"></div>
        <div class="panel-header">
          <h3>Phase &amp; Asset Summary</h3>
        </div>
        <div id="phaseAssetSummary" class="phase-summary"></div>
        <div class="panel-header">
          <h3>Roles &amp; Phase Assignments</h3>
          <button id="addAssignmentBtn" class="primary-btn" type="button">Add Assignment</button>
        </div>
        <div id="roleAssignment" class="asset-table"></div>
      </section>

      <section id="constraints" class="panel">
        <h2>Constraints</h2>
        <div class="grid two-col">
          <label>Time Window<input id="constraintTime" type="text"></label>
          <label>Environment<input id="constraintEnvironment" type="text"></label>
          <label>RF / EW Constraints<textarea id="constraintRf"></textarea></label>
          <label>Logistics Constraints<textarea id="constraintLogistics"></textarea></label>
          <label>Max Sorties<input id="constraintSorties" type="number" min="0" placeholder="e.g., 6"></label>
          <label>Min Battery Reserve (%)<input id="constraintReserve" type="number" min="0" max="100" step="5"></label>
          <label class="checkbox-row"><input type="checkbox" id="constraintRfCoverage"> Require RF coverage redundancy</label>
        </div>
        <label>Success Criteria<div id="successCriteriaList" class="editable-list"></div></label>
        <label>Risk Notes<textarea id="constraintRisk"></textarea></label>
      </section>

      <section id="brief" class="panel">
        <div class="panel-header">
          <h2>Mission Brief / Export</h2>
          <div class="button-row">
            <button id="printBtn" class="secondary-btn">Print / Save as PDF</button>
            <button id="downloadJsonBtn" class="primary-btn">Export MissionProject JSON</button>
            <button id="copyJsonBtn" class="secondary-btn">Copy MissionProject JSON</button>
            <button id="exportOverlayBtn" class="secondary-btn">Export GeoJSON</button>
          </div>
        </div>
        <article id="missionBrief" class="brief"></article>
        <section class="feasibility" id="feasibilityPanel"></section>
        <div class="export-block">
          <div class="panel-header">
            <h3>ATAK JSON Stub</h3>
            <button id="copyAtakBtn" class="secondary-btn">Copy ATAK Stub</button>
          </div>
          <textarea id="atakStub" readonly></textarea>
        </div>
      </section>

      <section id="mission-cards" class="panel">
        <div class="panel-header">
          <div>
            <h2>Mission Cards</h2>
            <p class="muted">Operator-facing cards driven by the shared MissionProject.</p>
          </div>
          <div class="button-row">
            <button id="printCardsBtn" class="secondary-btn">Print Mission Cards</button>
          </div>
        </div>
        <div id="missionSummaryBanner" class="mission-summary"></div>
        <section class="cards" id="missionCards"></section>
      </section>

      <section id="change-log" class="panel change-log-panel">
        <div class="panel-header">
          <h2>Change Log</h2>
          <p class="muted">Latest updates to the Ceradon Mission Architect SPA.</p>
        </div>
        <div id="changeLogList" class="change-log-list"></div>
      </section>
    </main>
    <footer class="app-footer">
      <div id="footerVersion"></div>
    </footer>
    <div id="demoAccessBanner" class="demo-access" style="display:none;">Demo access: MISSION-ORB-593</div>
  </div>

  <script src="app.js"></script>
  <script>
    const ACCESS_CODE = "MISSION-ORB-593";
    const STORAGE_KEY = "ceradon_demo_code";

    document.addEventListener("DOMContentLoaded", () => {
      const gate = document.getElementById("access-gate");
      const app = document.getElementById("app-root");
      const input = document.getElementById("demo-code");
      const button = document.getElementById("demo-enter");
      const errorEl = document.getElementById("demo-error");
      const demoBanner = document.getElementById("demoAccessBanner");

      if (!gate || !app || !input || !button || !errorEl) return;

      const legacyFlag = localStorage.getItem("ceradonDemoAuthorized") === "true";
      if (legacyFlag && !localStorage.getItem(STORAGE_KEY)) {
        localStorage.setItem(STORAGE_KEY, ACCESS_CODE);
      }

      const lockUi = () => {
        gate.style.display = "flex";
        app.style.display = "block";
        document.body.classList.add("app-locked");
        errorEl.style.display = "none";
        if (demoBanner) demoBanner.style.display = "none";
      };

      const unlock = () => {
        gate.style.display = "none";
        app.style.display = "block";
        document.body.classList.remove("app-locked");
        errorEl.style.display = "none";
        if (demoBanner) demoBanner.style.display = "block";
      };

      const storedCode = localStorage.getItem(STORAGE_KEY);

      if (storedCode === ACCESS_CODE) {
        unlock();
        return;
      }

      if (storedCode) {
        input.value = storedCode;
      }

      lockUi();

      const checkCode = () => {
        const value = input.value.trim();
        if (value === ACCESS_CODE) {
          localStorage.setItem(STORAGE_KEY, ACCESS_CODE);
          unlock();
        } else {
          errorEl.style.display = "block";
        }
      };

      button.addEventListener("click", checkCode);
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          checkCode();
        }
      });
    });
  </script>
</body>
</html>
